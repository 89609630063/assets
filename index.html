
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –±–ª–æ–∫–Ω–æ—Ç">
<link rel="apple-touch-icon" href="/assets/icons/icon-192.png">

<title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –±–ª–æ–∫–Ω–æ—Ç</title>
    
    <!-- –ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ -->
    <link rel="icon" href="./assets/icons/favicon.ico" type="image/x-icon">

    <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
    <!-- –ú–∞–Ω–∏—Ñ–µ—Å—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <link rel="manifest" href="manifest.json">
	<style>

/* –û–±—â–∏–π —Å—Ç–∏–ª—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 10px;
    text-align: center;
    overflow-x: hidden;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
    max-width: 400px;
    width: 90%;
    margin: auto;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
h1 {
    font-size: 22px;
    color: #333;
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
input {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
}
input {
    position: relative !important;
    z-index: 9999 !important;
    display: block !important;
    opacity: 1 !important;
    pointer-events: auto !important;
    user-select: text !important;
}
/* –û–±—â–∏–π —Å—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ */
button {
    display: block;
    width: 95%; /* –ü–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    max-width: 150px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —à–∏—Ä–∏–Ω–µ */
    padding: 12px 0; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É */
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    border: none;
    border-radius: 8px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫—Ä–∞–µ–≤ */
    cursor: pointer;
    transition: 0.2s ease-in-out;
    margin: 10px auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
.center-btn {
    display: flex;
    justify-content: center;
}

/* üé® –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" */
.add-btn {
    background: #4CAF50; /* –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ */
    color: white;
}

.add-btn:hover {
    background: #0056b3; /* –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

.container button {
    max-width: 100px;
    padding: 6px 0;
    font-size: 13px;
}

/* üé® –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å" */
.download-btn {
    background: #ff9800;
    color: white;
}

.download-btn:hover {
    background: #e68900;
}

.share-btn:hover {
    background: #388e3c;
}
.expense-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f8f8f8;
    padding: 10px;
    margin: 5px 0;
    border-radius: 6px;
}

.expense-buttons {
    display: flex;
    gap: 5px;
}
/* üì± –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 480px) {
    button {
        font-size: 14px;
        padding: 10px 0;
    }
}
html, body {
    overflow: auto !important;
}
    </style>
</head>
<body>

<div class="container">
    <h1>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –±–ª–æ–∫–Ω–æ—Ç</h1>
    <label>üí∞ –í–∞—à–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞:</label>
   <input type="number" id="salary" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞—Ä–ø–ª–∞—Ç—É" oninput="updateRemainingSalary()">
   <div id="remaining-salary">0 ‚ÇΩ</div>
    <label>üìã –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥:</label>
    <input type="text" id="expense-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    <input type="number" id="expense-amount" placeholder="–°—É–º–º–∞">
    <input type="date" id="expense-date">
    <!-- –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="add-btn" ontouchend="addExpense()">–î–æ–±–∞–≤–∏—Ç—å</button>

    <div class="expenses-list" id="expenses-list"></div>

    <div class="result">
        <p>–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: <b id="total-expenses">0 ‚ÇΩ</b></p>
        <p>–û—Å—Ç–∞–Ω–µ—Ç—Å—è: <b id="remaining-salary">0 ‚ÇΩ</b></p>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
    <canvas id="expenseChart"></canvas>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="buttons-container">
        <button class="download-btn" onclick="downloadData()">üì• –°–∫–∞—á–∞—Ç—å</button>
</div>

    <script>
    // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY
    function getCurrentDate() {
      const date = new Date();
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0'); // –ú–µ—Å—è—Ü—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
      const year = date.getFullYear();
      return `${day}.${month}.${year}`;
    }

    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
    function addExpense() {
      const name = document.getElementById("expense-name").value;
      const amount = parseFloat(document.getElementById("expense-amount").value);
      const date = getCurrentDate(); // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞
      const date = document.getElementById("expense-date").value; // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É
      
    if (!name || amount <= 0 || !date) {
        expenses.push({ name, amount, date });
        document.getElementById("expense-name").value = "";
        document.getElementById("expense-amount").value = "";
        document.getElementById("expense-date").value = ""; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –¥–∞—Ç—ã
        updateExpenses();
        saveToLocalStorage();
        updateRemainingSalary(); // üî• –¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ –¥–æ
        updateChart();
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
    function updateExpenses() {
      const list = document.getElementById("expenses-list");
      list.innerHTML = "";
        
        expenses.forEach(exp => {
        const item = document.createElement("li");
        item.innerHTML = `${exp.name} - ${exp.amount}‚ÇΩ (–û–ø–ª–∞—Ç–∏—Ç—å –¥–æ: ${exp.date})`;
        list.appendChild(item);
    });
}
      let totalExpenses = 0;
      expenses.forEach((expense, index) => {
        totalExpenses += expense.amount;
        list.innerHTML += `
          <div class="expense-item">
            <span id="expense-text-${index}">${expense.name} - ${formatNumber(expense.amount)} (${expense.date})</span>
            <div class="expense-buttons">
              <button onclick="editExpense(${index})">–†–µ–¥–∞–∫—Ç.</button>
              <button onclick="deleteExpense(${index})">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
        `;
      });

      document.getElementById("total-expenses").innerText = formatNumber(totalExpenses);
      updateRemainingSalary();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
    function deleteExpense(index) {
      expenses.splice(index, 1);
      updateExpenses();
      saveToLocalStorage();
      updateChart();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
    function editExpense(index) {
      const expense = expenses[index];
      const expenseText = document.getElementById(`expense-text-${index}`);
      expenseText.innerHTML = `
        <input type="text" id="edit-name-${index}" value="${expense.name}">
        <input type="number" id="edit-amount-${index}" value="${expense.amount}">
        <button onclick="saveExpense(${index})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="cancelEdit(${index})">–û—Ç–º–µ–Ω–∏—Ç—å</button>
      `;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞
    function saveExpense(index) {
      const newName = document.getElementById(`edit-name-${index}`).value;
      const newAmount = parseFloat(document.getElementById(`edit-amount-${index}`).value);

      if (newName && newAmount > 0) {
        expenses[index] = { name: newName, amount: newAmount, date: getCurrentDate() };
        updateExpenses();
        saveToLocalStorage();
        updateChart();
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function cancelEdit(index) {
      updateExpenses();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –∑–∞—Ä–ø–ª–∞—Ç—ã
    function updateRemainingSalary() {
    const salaryInput = document.getElementById("salary");
    const remainingDisplay = document.getElementById("remaining-salary");

    if (!salaryInput || !remainingDisplay) {
        console.error("‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–∞!");
        return;
    }

    let salary = parseFloat(salaryInput.value) || 0;
    let totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);

    let remaining = salary - totalExpenses;
    remainingDisplay.textContent = `${remaining} ‚ÇΩ`;
}

// –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫
document.addEventListener("DOMContentLoaded", () => {
    loadExpensesFromLocalStorage();
    updateRemainingSalary();
});

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª
    function formatNumber(number) {
      return new Intl.NumberFormat("ru-RU").format(number) + " ‚ÇΩ";
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ LocalStorage
    function saveToLocalStorage() {
      localStorage.setItem("expenses", JSON.stringify(expenses));
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ LocalStorage
    function loadFromLocalStorage() {
      expenses = JSON.parse(localStorage.getItem("expenses")) || [];
      updateExpenses();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    let chartInstance = null;

    function updateChart() {
      if (chartInstance) {
        chartInstance.destroy();
      }

      const ctx = document.getElementById("expenseChart").getContext("2d");

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º
      const monthlyExpenses = {};

      expenses.forEach(expense => {
        const date = new Date(expense.date.split('.').reverse().join('-')); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`; // YYYY-MM —Ñ–æ—Ä–º–∞—Ç
        if (!monthlyExpenses[monthKey]) {
          monthlyExpenses[monthKey] = 0;
        }
        monthlyExpenses[monthKey] += expense.amount;
      });

      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
      const labels = Object.keys(monthlyExpenses).sort(); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –º–µ—Å—è—Ü—É
      const data = labels.map(month => monthlyExpenses[month]);

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels, // –ú–µ—Å—è—Ü—ã
          datasets: [{
            label: "–†–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º",
            data: data, // –°—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –º–µ—Å—è—Ü
            backgroundColor: "rgba(255, 99, 132, 0.5)",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", function () {
      loadFromLocalStorage();
      updateChart();
    });
  </script>
<script>
function downloadData() {
    const salary = document.getElementById("salary").value || "–ù–µ —É–∫–∞–∑–∞–Ω–æ";
    const totalExpenses = document.getElementById("total-expenses").innerText;
    const remainingSalary = document.getElementById("remaining-salary").innerText;

    let data = `üìã –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç\n`;
    data += `üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞: ${salary} ‚ÇΩ\n`;
    data += `üìâ –†–∞—Å—Ö–æ–¥—ã: ${totalExpenses}\n`;
    data += `üíµ –û—Å—Ç–∞–Ω–µ—Ç—Å—è: ${remainingSalary}\n\n`;
    data += "üìå –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:\n";

    expenses.forEach(exp => {
        data += `- ${exp.name}: ${exp.amount} ‚ÇΩ\n`;
    });

    const bom = "\uFEFF"; // –î–æ–±–∞–≤–ª—è–µ–º BOM –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UTF-8
    const blob = new Blob([bom + data], { type: "text/plain;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π-–æ—Ç—á–µ—Ç.txt";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then((registration) => {
        console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏: ', registration);
      })
      .catch((error) => {
        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker: ', error);
      });
  });
}
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
window.onerror = function (message, source, lineno, colno, error) {
    alert(`–û—à–∏–±–∫–∞: ${message}\n–§–∞–π–ª: ${source}\n–°—Ç—Ä–æ–∫–∞: ${lineno}:${colno}`);
};

document.addEventListener("DOMContentLoaded", function () {
    console.log("PWA –∑–∞–≥—Ä—É–∂–µ–Ω!");
});

document.querySelectorAll("input").forEach(input => {
    input.addEventListener("focus", () => {
        console.log("–§–æ–∫—É—Å –Ω–∞", input.id);
    });

    input.addEventListener("blur", () => {
        console.log("–§–æ–∫—É—Å –ø–æ—Ç–µ—Ä—è–Ω", input.id);
    });

    input.addEventListener("touchend", (event) => {
        console.log("–ë—ã–ª –∫–ª–∏–∫ –ø–æ input:", event.target.id);
    });
});
document.querySelectorAll("input").forEach(input => {
    input.addEventListener("click", function () {
        console.log("–ö–ª–∏–∫ –ø–æ input:", this.id);
        setTimeout(() => {
            this.focus();
            console.log("–§–æ–∫—É—Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞", this.id);
        }, 500);
    });
});
</script>
</body>
</html>