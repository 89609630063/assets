<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">

    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –±–ª–æ–∫–Ω–æ—Ç</title>
    
    <!-- –ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ -->
    <link rel="icon" href="assets/icons/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
    <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->

    <!-- –ú–∞–Ω–∏—Ñ–µ—Å—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <link rel="manifest" href="manifest.json">
	<style>

/* –û–±—â–∏–π —Å—Ç–∏–ª—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 10px;
    text-align: center;
    overflow-x: hidden;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.container {
    max-width: 400px;
    width: 90%;
    margin: auto;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
h1 {
    font-size: 22px;
    color: #333;
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
input {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
}

/* –û–±—â–∏–π —Å—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ */
button {
    display: block;
    width: 95%; /* –ü–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    max-width: 150px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —à–∏—Ä–∏–Ω–µ */
    padding: 12px 0; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É */
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    border: none;
    border-radius: 8px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫—Ä–∞–µ–≤ */
    cursor: pointer;
    transition: 0.2s ease-in-out;
    margin: 10px auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
.center-btn {
    display: flex;
    justify-content: center;
}

/* üé® –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" */
.add-btn {
    background: #4CAF50; /* –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ */
    color: white;
}

.add-btn:hover {
    background: #0056b3; /* –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

.container button {
    max-width: 100px;
    padding: 6px 0;
    font-size: 13px;
}

/* üé® –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å" */
.download-btn {
    background: #ff9800;
    color: white;
}

.download-btn:hover {
    background: #e68900;
}

.share-btn:hover {
    background: #388e3c;
}
.expense-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f8f8f8;
    padding: 10px;
    margin: 5px 0;
    border-radius: 6px;
}

.expense-buttons {
    display: flex;
    gap: 5px;
}
/* üì± –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 480px) {
    button {
        font-size: 14px;
        padding: 10px 0;
    }
}

    </style>
</head>
<body>

<div class="container">
    <h1>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –±–ª–æ–∫–Ω–æ—Ç</h1>

    <label>üí∞ –í–∞—à–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞:</label>
    <input type="number" id="salary" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" oninput="updateRemainingSalary()">

    <label>üìã –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥:</label>
    <input type="text" id="expense-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
	<label>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
<select id="expense-category">
    <option value="–ï–¥–∞">–ï–¥–∞</option>
    <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
    <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
    <option value="–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ</option>
    <option value="–ó–¥–æ—Ä–æ–≤—å–µ">–ó–¥–æ—Ä–æ–≤—å–µ</option>
    <option value="–ö—Ä–µ–¥–∏—Ç">–ö—Ä–µ–¥–∏—Ç</option>
    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
</select>
    <input type="number" id="expense-amount" placeholder="–°—É–º–º–∞">
    <input type="date" id="payment-date" placeholder="–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞">
    <!-- –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="add-btn" onclick="addExpense()">–î–æ–±–∞–≤–∏—Ç—å</button>

    <div class="expenses-list" id="expenses-list"></div>

    <div class="result">
        <p>üîÆ –ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü: <b id="predicted-expenses">0 ‚ÇΩ</b></p>
<p>‚ö†Ô∏è <span id="budget-warning" style="color: red;"></span></p>
		<p>–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: <b id="total-expenses">0 ‚ÇΩ</b></p>
        <p>–û—Å—Ç–∞–Ω–µ—Ç—Å—è: <b id="remaining-salary">0 ‚ÇΩ</b></p>
    </div>
<div class="advice-section">
    <h3>üí° –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç:</h3>
    <p id="financial-advice">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...</p>
</div>
    <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
    <canvas id="expenseChart"></canvas>
	<button onclick="generateDetailedReport()">üìä–û—Ç—á–µ—Ç </button>
<p>üìÖ –î–æ –ó–ü –æ—Å—Ç–∞–ª–æ—Å—å: <b id="days-until-salary"></b> –¥–Ω–µ–π</p>
<label>üíµ –î–µ–Ω—å –ó–ü —á–∏—Å–ª–æ:</label>
<input type="number" id="salary-day" min="1" max="31" value="5" onchange="updateSalaryCountdown()">
    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="buttons-container">
        <button class="download-btn" onclick="downloadData()">üì• –°–∫–∞—á–∞—Ç—å</button>
</div>

    <script>
    // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY
    function getCurrentDate() {
      const date = new Date();
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0'); // –ú–µ—Å—è—Ü—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
      const year = date.getFullYear();
      return `${day}.${month}.${year}`;
    }

    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
 function addExpense() {
    const name = document.getElementById("expense-name").value;
    const amount = parseFloat(document.getElementById("expense-amount").value);
    const dateInput = document.getElementById("payment-date").value;
    const category = document.getElementById("expense-category").value; // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é

    if (!dateInput) {
        alert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –ø–ª–∞—Ç–µ–∂–∞!");
        return;
    }

    const date = new Date(dateInput).toLocaleDateString("ru-RU");

    if (name && amount > 0) {
        expenses.push({ name, amount, date, category });
        document.getElementById("expense-name").value = "";
        document.getElementById("expense-amount").value = "";
        document.getElementById("payment-date").value = "";
        document.getElementById("expense-category").value = "–î—Ä—É–≥–æ–µ"; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        updateExpenses();
        saveToLocalStorage();
        updateChart();
    }
}
    
	function predictNextMonthExpenses() {
    let monthlyTotals = {};
    let today = new Date();
    let currentMonth = today.getMonth() + 1;
    let currentYear = today.getFullYear();

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º
    expenses.forEach(expense => {
        let dateParts = expense.date.split('.');
        let year = parseInt(dateParts[2]);
        let month = parseInt(dateParts[1]);

        let monthKey = `${year}-${month}`;
        if (!monthlyTotals[monthKey]) {
            monthlyTotals[monthKey] = 0;
        }
        monthlyTotals[monthKey] += expense.amount;
    });

    // –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    let lastThreeMonths = Object.keys(monthlyTotals).sort().slice(-3);
    let sumLastThree = lastThreeMonths.reduce((sum, key) => sum + monthlyTotals[key], 0);
    let avgMonthlyExpense = lastThreeMonths.length > 0 ? sumLastThree / lastThreeMonths.length : 0;

    // –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π —Ä–∞—Å—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
    let predictedNextMonth = avgMonthlyExpense.toFixed(2);
    document.getElementById("predicted-expenses").innerText = formatNumber(predictedNextMonth);

    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ç—Ä–∞—Ç—ã —Ä–∞—Å—Ç—É—Ç
    let lastMonthKey = `${currentYear}-${currentMonth}`;
    if (monthlyTotals[lastMonthKey] && monthlyTotals[lastMonthKey] > avgMonthlyExpense * 1.2) {
        document.getElementById("budget-warning").innerText = "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –í–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –≤—ã—à–µ –æ–±—ã—á–Ω–æ–≥–æ!";
    } else {
        document.getElementById("budget-warning").innerText = "";
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener("DOMContentLoaded", predictNextMonthExpenses);
	
	function generateFinancialAdvice() {
    if (expenses.length === 0) {
        document.getElementById("financial-advice").innerText = "–î–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç—ã!";
        return;
    }

    let categoryTotals = {};
    let totalExpenses = 0;
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    expenses.forEach(expense => {
        let category = expense.category ? expense.category : "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏";
        
        totalExpenses += expense.amount;
        if (!categoryTotals[category]) {
            categoryTotals[category] = 0;
        }
        categoryTotals[category] += expense.amount;
    });

    if (Object.keys(categoryTotals).length === 0) {
        document.getElementById("financial-advice").innerText = "–ù–µ –º–æ–≥—É –¥–∞—Ç—å —Å–æ–≤–µ—Ç ‚Äì –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ —Ä–∞—Å—Ö–æ–¥–æ–≤.";
        return;
    }

    let mostExpensiveCategory = Object.keys(categoryTotals).reduce((a, b) => categoryTotals[a] > categoryTotals[b] ? a : b);

    let advice = "";
    if (categoryTotals[mostExpensiveCategory] > totalExpenses * 0.3) {
        advice = `üìå –í—ã —Ç—Ä–∞—Ç–∏—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–∞ **${mostExpensiveCategory}** (${formatNumber(categoryTotals[mostExpensiveCategory])}). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —ç—Ç–∏ —Ä–∞—Å—Ö–æ–¥—ã!`;
    } else if (totalExpenses > 50000) {
        advice = "üí∞ –í–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç 50 000 ‚ÇΩ. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –±—é–¥–∂–µ—Ç –∏ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ç—Ä–∞—Ç—ã.";
    } else if (expenses.length >= 10) {
        advice = "üéØ –£ –≤–∞—Å –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –ø–æ–∫—É–ø–æ–∫. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –∏—Å–∫–ª—é—á–∏—Ç—å –∏–º–ø—É–ª—å—Å–∏–≤–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏?";
    } else {
        advice = "‚úÖ –í–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –≤—ã–≥–ª—è–¥—è—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.";
    }

    document.getElementById("financial-advice").innerText = advice;
}

// –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener("DOMContentLoaded", generateFinancialAdvice);
	// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
    function updateExpenses() {
      const list = document.getElementById("expenses-list");
      list.innerHTML = "";

      let totalExpenses = 0;
      expenses.forEach((expense, index) => {
        totalExpenses += expense.amount;
        list.innerHTML += `
  <div class="expense-item">
    <span id="expense-text-${index}">${expense.name} - ${formatNumber(expense.amount)} (${expense.date}) <br> üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: <b>${expense.category}</b></span>
    <div class="expense-buttons">
      <button onclick="editExpense(${index})">–†–µ–¥.</button>
      <button onclick="deleteExpense(${index})">–£–¥–∞–ª–∏—Ç—å</button>
    </div>
  </div>
  `;
      });

      document.getElementById("total-expenses").innerText = formatNumber(totalExpenses);
      updateRemainingSalary();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
    function deleteExpense(index) {
      expenses.splice(index, 1);
      updateExpenses();
      saveToLocalStorage();
      updateChart();
    }
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD –¥–ª—è input type="date"
    function formatDateForInput(dateString) {
       const parts = dateString.split(".");
       
	   if (parts.length === 3) {
        return `${parts[2]}-${parts[1]}-${parts[0]}`; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ YYYY-MM-DD
    }
    return "";
   }
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
   function editExpense(index) {
    const expense = expenses[index];
    const expenseText = document.getElementById(`expense-text-${index}`);

    expenseText.innerHTML = `
        <input type="text" id="edit-name-${index}" value="${expense.name}">
        <input type="number" id="edit-amount-${index}" value="${expense.amount}">
        <input type="date" id="edit-date-${index}" value="${formatDateForInput(expense.date)}">
        <button onclick="saveExpense(${index})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="cancelEdit(${index})">–û—Ç–º–µ–Ω–∏—Ç—å</button>
    `;
}

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞
   function saveExpense(index) {
    const newName = document.getElementById(`edit-name-${index}`).value;
    const newAmount = parseFloat(document.getElementById(`edit-amount-${index}`).value);
    const newDate = document.getElementById(`edit-date-${index}`).value;

    if (newName && newAmount > 0 && newDate) {
        expenses[index] = { 
            name: newName, 
            amount: newAmount, 
            date: new Date(newDate).toLocaleDateString("ru-RU") // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ DD.MM.YYYY
        };
        updateExpenses();
        saveToLocalStorage();
        updateChart();
    }
}
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function cancelEdit(index) {
      updateExpenses();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–π—Å—è –∑–∞—Ä–ø–ª–∞—Ç—ã
    function updateRemainingSalary() {
      const salary = parseFloat(document.getElementById("salary").value) || 0;
      const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      document.getElementById("remaining-salary").innerText = formatNumber(salary - totalExpenses);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª
    function formatNumber(number) {
      return new Intl.NumberFormat("ru-RU").format(number) + " ‚ÇΩ";
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ LocalStorage
    function saveToLocalStorage() {
      localStorage.setItem("expenses", JSON.stringify(expenses));
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ LocalStorage
    function loadFromLocalStorage() {
      expenses = JSON.parse(localStorage.getItem("expenses")) || [];
      updateExpenses();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    let chartInstance = null;

    function updateChart() {
      if (chartInstance) {
        chartInstance.destroy();
      }

      const ctx = document.getElementById("expenseChart").getContext("2d");

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º
      const monthlyExpenses = {};

      expenses.forEach(expense => {
        const date = new Date(expense.date.split('.').reverse().join('-')); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`; // YYYY-MM —Ñ–æ—Ä–º–∞—Ç
        if (!monthlyExpenses[monthKey]) {
          monthlyExpenses[monthKey] = 0;
        }
        monthlyExpenses[monthKey] += expense.amount;
      });

      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
      const labels = Object.keys(monthlyExpenses).sort(); // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –º–µ—Å—è—Ü—É
      const data = labels.map(month => monthlyExpenses[month]);

      chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels, // –ú–µ—Å—è—Ü—ã
          datasets: [{
            label: "–†–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º",
            data: data, // –°—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –º–µ—Å—è—Ü
            backgroundColor: "rgba(255, 99, 132, 0.5)",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", function () {
      loadFromLocalStorage();
      updateChart();
    });
  </script>
<script>
function downloadData() {
    const salary = document.getElementById("salary").value || "–ù–µ —É–∫–∞–∑–∞–Ω–æ";
    const totalExpenses = document.getElementById("total-expenses").innerText;
    const remainingSalary = document.getElementById("remaining-salary").innerText;

    let data = `üìã –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç\n`;
    data += `üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞: ${salary} ‚ÇΩ\n`;
    data += `üìâ –†–∞—Å—Ö–æ–¥—ã: ${totalExpenses}\n`;
    data += `üíµ –û—Å—Ç–∞–Ω–µ—Ç—Å—è: ${remainingSalary}\n\n`;
    data += "üìå –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è:\n";

    expenses.forEach(exp => {
        data += `- ${exp.name}: ${exp.amount} ‚ÇΩ\n`;
    });

    const bom = "\uFEFF"; // –î–æ–±–∞–≤–ª—è–µ–º BOM –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UTF-8
    const blob = new Blob([bom + data], { type: "text/plain;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π-–æ—Ç—á–µ—Ç.txt";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then((registration) => {
        console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏: ', registration);
      })
      .catch((error) => {
        console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker: ', error);
      });
  });
}
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function updateSalaryCountdown() {
    const today = new Date();
    const salaryDay = parseInt(document.getElementById("salary-day").value) || 5; // –ë–µ—Ä—ë–º –¥–∞—Ç—É –∏–∑ –∏–Ω–ø—É—Ç–∞
    
    let nextSalaryDate = new Date(today.getFullYear(), today.getMonth(), salaryDay);

    if (today.getDate() >= salaryDay) {
        nextSalaryDate = new Date(today.getFullYear(), today.getMonth() + 1, salaryDay);
    }

    const diff = Math.ceil((nextSalaryDate - today) / (1000 * 60 * 60 * 24));

    document.getElementById("days-until-salary").innerText = diff;
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ localStorage, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
document.addEventListener("DOMContentLoaded", () => {
    const savedSalaryDay = localStorage.getItem("salaryDay");
    if (savedSalaryDay) {
        document.getElementById("salary-day").value = savedSalaryDay;
    }
    updateSalaryCountdown();
});

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –≤ localStorage
document.getElementById("salary-day").addEventListener("change", function () {
    localStorage.setItem("salaryDay", this.value);
    updateSalaryCountdown();
});
</script>
<script>
let reportWindow; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–∫–Ω–æ

function generateDetailedReport() {
    let totalExpenses = 0;
    let categoryTotals = {};
    let monthlyTotals = {};
    let dailyExpenses = {};

    expenses.forEach(expense => {
        totalExpenses += expense.amount;
        let category = expense.category ? expense.category : "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏";

        if (!categoryTotals[category]) {
            categoryTotals[category] = 0;
        }
        categoryTotals[category] += expense.amount;

        let dateParts = expense.date.split('.');
        let monthKey = `${dateParts[2]}-${dateParts[1]}`;
        if (!monthlyTotals[monthKey]) {
            monthlyTotals[monthKey] = 0;
        }
        monthlyTotals[monthKey] += expense.amount;

        if (!dailyExpenses[expense.date]) {
            dailyExpenses[expense.date] = 0;
        }
        dailyExpenses[expense.date] += expense.amount;
    });

    let daysTracked = Object.keys(dailyExpenses).length;
    let avgDailyExpense = daysTracked > 0 ? (totalExpenses / daysTracked).toFixed(2) : 0;

    let reportHTML = `
        <html>
        <head>
            <title>–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
                h2, h3 { color: #333; }
                ul { padding-left: 20px; text-align: left; }
                button { padding: 10px 20px; background-color: #ff4d4d; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px; }
            </style>
        </head>
        <body>
            <h2>üìä –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç</h2>
            <p>üí∞ <b>–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã:</b> ${formatNumber(totalExpenses)}</p>
            <p>üìÖ <b>–°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –≤ –¥–µ–Ω—å:</b> ${formatNumber(avgDailyExpense)}</p>

            <h3>üìÇ –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</h3>
            <ul>${Object.keys(categoryTotals).map(cat => `<li>${cat}: <b>${formatNumber(categoryTotals[cat])}</b></li>`).join("")}</ul>

            <h3>üìÜ –†–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º:</h3>
            <ul>${Object.keys(monthlyTotals).map(month => `<li>${month}: <b>${formatNumber(monthlyTotals[month])}</b></li>`).join("")}</ul>

            <h3>üìå –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ä–∞—Å—Ö–æ–¥–æ–≤:</h3>
            <ul>${expenses.slice(-5).reverse().map(exp => `<li>${exp.date}: ${exp.name} - <b>${formatNumber(exp.amount)}</b> (${exp.category})</li>`).join("")}</ul>
            <button onclick="goBack()" style="padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
            <button onclick="window.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </body>
        </html>
    `;

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Ç—á–µ—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ–≥–æ
    reportWindow = window.open("", "_blank", "width=500,height=600");
    reportWindow.document.write(reportHTML);
    reportWindow.document.close(); // –ó–∞–≤–µ—Ä—à–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –æ–∫–Ω–æ
}
</script>
<script>
function goBack() {
    location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
}
</script>
</body>
</html>
